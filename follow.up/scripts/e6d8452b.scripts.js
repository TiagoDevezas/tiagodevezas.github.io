"use strict";angular.module("followupApp",[]).run(["$rootScope","$location","$window",function(e,t,o){e.$on("$routeChangeSuccess",function(){o.ga&&o.ga("send","pageview",{page:t.path()})})}]).config(["$routeProvider",function(e){e.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/sobre",{templateUrl:"views/about.html"}).when("/:uo",{templateUrl:"views/main.html",controller:"UoCtrl"}).when("/:uo/topico/:topic",{templateUrl:"views/main.html",controller:"UoTopicCtrl"}).when("/search/:q",{templateUrl:"views/main.html",controller:"SearchResultsCtrl"}).when("/search/:uo/:q",{templateUrl:"views/main.html",controller:"SearchResultsCtrl"}).otherwise({redirectTo:"/"})}]),$(function(){$(document).foundation()}),angular.module("followupApp").controller("MainCtrl",["getArticles","$scope","$rootScope",function(e,t,o){t.uoList=[{name:"Todas",url:""},{name:"FADEUP",url:"FADEUP"},{name:"FAUP",url:"FAUP"},{name:"FBAUP",url:"FBAUP"},{name:"FCNAUP",url:"FCNAUP"},{name:"FCUP",url:"FCUP"},{name:"FDUP",url:"FDUP"},{name:"FEP",url:"FEP"},{name:"FEUP",url:"FEUP"},{name:"FFUP",url:"FFUP"},{name:"FLUP",url:"FLUP"},{name:"FMDUP",url:"FMDUP"},{name:"FMUP",url:"FMUP"},{name:"FPCEUP",url:"FPCEUP"},{name:"ICBAS",url:"ICBAS"},{name:"REITORIA",url:"REITORIA"}],t.articles=[],t.busy=!1;var n=0;o.showDescription=void 0===o.showDescription?!0:o.showDescription,t.setDescription=function(e){o.showDescription=e},t.closeMobileMenu=function(){$(".top-bar").removeClass("expanded")},t.hideTopicButton=!0,t.hideSourceButton=!0,t.loadMore=function(){t.busy||(t.busy=!0,e.async({offset:n}).then(function(e){return t.articles=t.articles.concat(e),o.header="Todas",10>e.length?(t.showBox=!0,void 0):(t.busy=!1,void 0)}),n+=10)},0===n&&t.loadMore()}]),angular.module("followupApp").controller("UoCtrl",["getArticles","$scope","$rootScope","$routeParams","$location",function(e,t,o,n,a){t.hideTopicButton=!1,t.articles=[],t.busy=!1;var r=0;t.redirectIfEmpty=function(){0===t.articles.length&&a.path("/")},t.convertToFullName=function(e){var t=e;switch(t){case"FADEUP":return"Faculdade de Desporto";case"FAUP":return"Faculdade de Arquitectura";case"FBAUP":return"Faculdade de Belas Artes";case"FCNAUP":return"Faculdade de Ciências da Nutrição e Alimentação";case"FCUP":return"Faculdade de Ciências";case"FDUP":return"Faculdade de Direito";case"FEP":return"Faculdade de Economia";case"FEUP":return"Faculdade de Engenharia";case"FFUP":return"Faculdade de Farmácia";case"FLUP":return"Faculdade de Letras";case"FMDUP":return"Faculdade de Medicina Dentária";case"FMUP":return"Faculdade de Medicina";case"FPCEUP":return"Faculdade de Psicologia e Ciências da Educação";case"ICBAS":return"Instituto de Ciências Biomédicas Abel Salazar";case"REITORIA":return"Reitoria"}},t.loadMore=function(){t.busy||(t.busy=!0,e.async({uo:n.uo,offset:r}).then(function(e){return t.articles=t.articles.concat(e),t.redirectIfEmpty(),o.header=t.convertToFullName(n.uo),10>e.length?(t.showBox=!0,void 0):(t.busy=!1,void 0)}),r+=10)},0===r&&t.loadMore()}]),angular.module("followupApp").controller("TopicListCtrl",["getTopics","$scope","$rootScope","$routeParams","$location",function(e,t,o,n){void 0!==n.uo&&e.async({uo:n.uo}).then(function(e){o.uoParam=n.uo,t.topics=e,o.topics=e,o.topicCount=o.topics.length,t.uo=""!==n.uo?n.uo:"todas"})}]),angular.module("followupApp").controller("UoTopicCtrl",["getArticles","$scope","$rootScope","$routeParams","$location",function(e,t,o,n){t.topic="todos"===n.topic?"Todos":n.topic,t.hideTopicButton=!1,t.hideDate=!0,t.hideSource=!0,t.articles=[],t.busy=!1;var a=0;t.convertToFullName=function(e){var t=e;switch(t){case"FADEUP":return"Faculdade de Desporto";case"FAUP":return"Faculdade de Arquitectura";case"FBAUP":return"Faculdade de Belas Artes";case"FCNAUP":return"Faculdade de Ciências da Nutrição e Alimentação";case"FCUP":return"Faculdade de Ciências";case"FDUP":return"Faculdade de Direito";case"FEP":return"Faculdade de Economia";case"FEUP":return"Faculdade de Engenharia";case"FFUP":return"Faculdade de Farmácia";case"FLUP":return"Faculdade de Letras";case"FMDUP":return"Faculdade de Medicina Dentária";case"FMUP":return"Faculdade de Medicina";case"FPCEUP":return"Faculdade de Psicologia e Ciências da Educação";case"ICBAS":return"Instituto de Ciências Biomédicas Abel Salazar";case"REITORIA":return"Reitoria"}},"todos"===n.topic&&(n.topic=""),t.loadMore=function(){t.busy||(t.busy=!0,e.async({feed:n.topic,uo:n.uo,offset:a}).then(function(e){return t.articles=t.articles.concat(e),""===n.uo?(o.header="Todas",t.subheader=n.topic):(o.header=t.convertToFullName(n.uo),t.subheader=n.topic),10>e.length?(t.showBox=!0,void 0):(t.busy=!1,void 0)}),a+=10)},0===a&&t.loadMore()}]),angular.module("followupApp").controller("SearchCtrl",["$scope","$location",function(e,t){e.search=function(){t.path("/search/"+e.query)}}]),angular.module("followupApp").controller("SearchResultsCtrl",["getArticles","$scope","$rootScope","$routeParams","$location",function(e,t,o,n){function a(){e.async({query:n.q,limit:"off"}).then(function(e){t.getSources(e)})}function r(e,o){angular.forEach(e,function(e){var n=0;angular.forEach(o,function(t){t.source==e&&n++}),t.sources.push({name:e,count:n})})}t.articles=[],t.sources=[],t.source=void 0===n.uo?"Todas":n.uo,t.query=n.q,t.busy=!1;var u=0;t.loading=!0,a(),t.hideDate=!0,t.checkResults=function(){0===t.articles.length&&(t.hideFilterOptions=!0,t.hideViewButtons=!0,t.noResults=!0)},t.getSources=function(e){var o=[];angular.forEach(e,function(e){-1===o.indexOf(e.source)&&o.push(e.source)}),r(o,e),t.loading=!1},t.hideTopics=!0,t.hideSourceButton=!1,t.loadMore=function(){t.busy||(t.busy=!0,e.async({query:n.q,uo:n.uo,offset:u}).then(function(e){return t.articles=t.articles.concat(e),o.header="Pesquisa por: "+n.q,t.checkResults(),10>e.length&&0!=e.length?(t.showBox=!0,void 0):(t.busy=!1,void 0)}),u+=10)},0===u&&t.loadMore()}]),angular.module("followupApp").controller("DateFilterCtrl",["$scope","getArticles","$routeParams",function(e,t,o){function n(e,t,o){return new Date(e.getFullYear(),e.getMonth()-o,e.getDate()-t)}function a(e){var t=e.getFullYear(),o=e.getMonth(),n=e.getDate();return o=9>o?"0"+(o+1):o+1,n=10>n?"0"+n:n,""+t+"-"+(""+o)+"-"+(""+n)}function r(o){e.busy=!1,t.async(o).then(function(t){return e.articles=e.articles.concat(t),0===t.length&&(e.noResults=!0,e.busy=!0),10>t.length&&0!=t.length?(e.showBox=!0,void 0):void 0}),s+=10,e.loadMore=function(){o.offset=s,e.busy||(e.busy=!0,e.noResults=!1,t.async(o).then(function(t){return e.articles=e.articles.concat(t),10>t.length&&0!=t.length?(e.showBox=!0,void 0):(e.busy=!1,void 0)}),s+=10)},0===s&&e.loadMore()}var u=new Date,i=n(u,1,0),c=n(u,7,0),l=n(u,0,1);e.dateText=function(){return e.startDate||e.endDate?(e.dateOptions="-","Intervalo Personalizado"):e.dateOptions},e.selectOptions=["Qualquer altura","Último dia","Última semana","Último mês"],e.dateOptions=e.selectOptions[0];var s;e.uo=o.uo,e.searchArticles=function(){e.articles=[],s=0,r({feed:o.topic,uo:o.uo,from:e.startDate,until:e.endDate,offset:s,query:o.q}),e.showPanel=!1},e.change=function(t){e.startDate="",e.endDate="",e.articles=[],e.showPanel=!1,s=0,t===e.selectOptions[0]&&r({feed:o.topic,uo:o.uo,offset:s,query:o.q}),t===e.selectOptions[1]&&r({feed:o.topic,uo:o.uo,from:a(i),until:a(u),offset:s,query:o.q}),t===e.selectOptions[2]&&r({feed:o.topic,uo:o.uo,from:a(c),until:a(u),offset:s,query:o.q}),t===e.selectOptions[3]&&r({feed:o.topic,uo:o.uo,from:a(l),until:a(u),offset:s,query:o.q})}}]),angular.module("followupApp").directive("activeLink",["$location",function(e){return{restrict:"A",link:function(t,o,n){var a,r=n.activeLink;n.$observe("href",function(e){a=e.substring(1)}),t.location=e,t.$watch("location.path()",function(e){-1!==e.indexOf(a)?($("dd").removeClass(r),o.parent().addClass(r),"/"===a&&"/"!==e&&o.parent().removeClass(r)):o.parent().removeClass(r)})}}}]),angular.module("followupApp").directive("infiniteScroll",["$rootScope","$window","$timeout",function(e,t,o){return{link:function(n,a,r){var u,i,c,l;return t=angular.element(t),c=0,null!==r.infiniteScrollDistance&&n.$watch(r.infiniteScrollDistance,function(e){return c=parseInt(e,10)}),l=!0,u=!1,null!==r.infiniteScrollDisabled&&n.$watch(r.infiniteScrollDisabled,function(e){return l=!e,l&&u?(u=!1,i()):void 0}),i=function(){var o,i,s,d;return d=t.height()+t.scrollTop(),o=a.offset().top+a.height(),i=o-d,s=t.height()*c>=i,s&&l?e.$$phase?n.$eval(r.infiniteScroll):n.$apply(r.infiniteScroll):s?u=!0:void 0},t.on("scroll",i),n.$on("$destroy",function(){return t.off("scroll",i)}),o(function(){return r.infiniteScrollImmediateCheck?n.$eval(r.infiniteScrollImmediateCheck)?i():void 0:i()},0)}}}]),angular.module("followupApp").directive("myDatePicker",["$parse",function(e){return function(t,o,n){var a=e(n.ngModel);$(function(){o.datepicker({changeYear:!0,changeMonth:!0,dateFormat:"yy-mm-dd",maxDate:new Date,onSelect:function(e){t.$apply(function(t){a.assign(t,e)})}})})}}]),angular.module("followupApp").directive("listToggle",function(){return{restrict:"A",link:function(e,t,o){t.bind("click",function(){var e=o.listToggle;$(".list-toggle").removeClass(e),t.addClass(e)})}}}),angular.module("followupApp").factory("getArticles",["$http",function(e){var t={};return t.async=function(t){var o="http://irlab.fe.up.pt/p/follow.up/api/items.php?",n=t.feed?"&feed="+t.feed:"",a=t.uo?"&uo="+t.uo:"",r=t.from?"&since="+t.from:"",u=t.until?"&until="+t.until:"",i=t.offset?"&offset="+t.offset:"",c=t.limit?"&limit="+t.limit:"",l=t.query?"&q="+t.query:"",s="&callback=JSON_CALLBACK";return e.jsonp(o+n+l+a+r+u+i+c+s).then(function(e){var t=e.data;return t})},t}]),angular.module("followupApp").factory("getTopics",["$http",function(e){var t={};return t.async=function(t){var o="http://irlab.fe.up.pt/p/follow.up/api/feeds.php?",n=t.uo?"&uo="+t.uo:"",a="&sort=total",r="&callback=JSON_CALLBACK";return e.jsonp(o+n+a+r).then(function(e){var t=e.data;return t})},t}]),angular.module("followupApp").filter("urlify",function(){return function(e){return e.replace("/","&frasl;")}}),angular.module("followupApp").filter("trimDate",function(){return function(e){var t=e.split(" "),o=t[0],n=t[1],a=n.split(":");return a.pop(),a=a.join(":"),o+" "+a}});